# Prize-collecting Steiner tree analysis (Belyaeva et al., 2020)

This directory includes Jupyter notebooks and Python libraries required to replicate the results of the main Steiner tree analysis of Belyaeva et al. (2020) as well as a variety of randomization-based robustness analyses. We focus in this README section on the Jupyter notebook Code/SteinerTree_notebook.ipynb which reproduces the results and figures of the main Steiner Tree analysis of Belyaeva et al. (2020). The code can be adapted to your specific use case should you want to conduct a drug repurposing analysis in the spirit of Belyaeva et al. Before adapting the notebook to your problem, we recommend that you fully run it using the data of Belyaeva et al. in order to familiarize yourself with the main steps and the data format/structures.

In order to run this notebook you will need the following Python libraries: networkx (for network analysis) and OmicsIntegrator2 (for an implementation of the prize-collecting Steiner Tree algorithm, PCST). OmicsIntegrator2 can be obtained from https://github.com/fraenkel-lab/OmicsIntegrator2. Some custom libraries are necessary, available in the Uhler lab covid19_steiner_tree_analysis Github repository, as well as data sets available in the following Dropbox repository: https://www.dropbox.com/sh/x30hdd88hgixa65/AACoVJB8LS6weM1t_aXuq_d4a?dl=0. Here are brief descriptions of these libraries:

- prizes.py: functions to create the list of important genes (called terminal genes), along with their prizes, for the PCST algorithm. 
- sensitivity_analysis.py: functions to conduct a sensivity analysis on the hyperparameters (g,w,b) of the PCST algorithm
- sensitivity_sarspartners.py: functions to conduct a sensitivy analysis on the prize $p$ given to non-terminal SARS-Cov-2 partners in the PCST algorithm, if we want to include these genes as terminal nodes
- drugs2.py: functions to preprocess drug/target data from DrugCentral, load SARS-Cov-2-anticorrelated drugs data and combine these two sources of information to obtain the set of selected drugs and metadata.
- neighborhoods.py: functions to plot neighborhoods of the protein-protein interaction subnetwork selected with the PCST algorithm, allowing for visualizations of a variety of metadata (drug targets, terminal nodes, SARS-Cov-2 interaction partners)

We now provide the main steps of the PCST analysis in Belyaeva et al., and we refer the reader to the article for more details. The first step consists of specifying a list of important genes, in our case genes that are differentially expressed due to SARS-Cov-2 infection and aging:
- Create a list of prized terminal genes for the PCST algorithm. In our case, this list is obtained by using genes that are differentially expressed due to SARS-Cov-2 infection and aging, with prizes equal to the log2 fold change between SARS-Cov-2-infected A549-ACE2 cells and normal A549-ACE2 cells. 
- Note that the user can substitute any prized list of their choice, as long as it comes in the form of a pandas dataframe with the following columns: 'name', 'prize'.

The second step consists of constructing a robust minimal subnetwork of the human protein-protein interaction network including the set of terminal nodes. This task is performed using the PCST algorithm:
- Use the IREF protein-protein interaction network. The user may substitute any other interactome if the corresponding file is in the correct .txt format (three columns: 'protein1', 'protein2', 'cost').
- Determine a reasonable range of variation for the PCST parameters g, w, b. To select the range of w we plot the histogram of the cost of the shortest path between two terminals, to determine the value of g we plot the distribution of edge costs in the interactome for several values of g, and to determine the range of b we look at the maximal penalized edge cost in the interactome. In general we prefer to set g=-\infty, but this is not an available option in the OmicsIntegrator2 framework, so we use g=0 which yields very similar results.
- Run a sensitivity analysis to determine the values of w and b to be used in the PCST algorithm. Heatmaps comparing selected nodes for each parameter configurations are used to determine a stable w, b, g configuration.
- Perform a similar procedure to select the prize p given to SARS-Cov-2 partners (that are not already present in the terminal list), should we be interested in including these genes in the terminal list. The choice of p depends on the number of SARS-Cov-2 partners selected in the Steiner tree, and on the stability of that choice (i.e. moderately changing the value of p leads to similar interactomes).

The above steps lead to a robust interactome. The third step consists of enriching the interactome with drug-related metadata.
- Construct a dataframe of FDA-approved drugs along with metadata (targets, affinity constants) from DrugCentral.
- Only keep drugs whose anticorrelation with the SARS-Cov-2 signature is higher than a user-defined threshold (in our case, 0.86). Anticorrelation coefficients are available in the .csv format.
- Add drug target information to the interactome, and obtain which nodes in the interactome can be targeted by FDA-approved drugs. This information is then summarized in a table which is exported to .csv for further analysis.
- Visualize 2-nearest-neighborhoods of nodes of interest using the neighborhoods.py library. This library gives the possibility of discarding the hub node UBC and of not displaying low confidence (high cost) edges in the PPI, leading to clearer visualizations.
